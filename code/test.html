<!DOCTYPE html>
<html>
    <head>
        <meta charset=utf-8>
        <title>test</title>
        <script src="https://unpkg.com/vue@3.2.31"></script>
        <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    </head>
<style type="text/css">
body {
  margin: 30px;
}

</style>

<body>


<script type="text/javascript">
  var delegate=function(client,delegation){
    return {
      buttonWasPressed:function(){  //将客户的操作委托给 delegation 对象
        return delegation.buttonWasPressed.apply(client,arguments);
      }
    }
  };
  var FSM={
    off:{
      buttonWasPressed:function(){
        console.log("关灯");
        this.button.innerHTML = '下一次按我是开灯';
        this.currState = this.onState;
      }
    },
    on:{
      buttonWasPressed:function(){
        console.log( '开灯' );
        this.button.innerHTML = '下一次按我是关灯';
        this.currState = this.offState;
      }
    }
  };
  var Light=function(){
    this.offState=delegate(this,FSM.off);
    this.onState=delegate(this,FSM.on);
    this.currState=this.offState;  //设置当前状态
    this.button=null;
  };
  Light.prototype.init=function(){
    var button=document.createElement("button");
    var self=this;
    button.innerHTML="已关灯";
    this.button=document.body.appendChild(button);
    this.button.onclick=function(){
      self.currState.buttonWasPressed();  // 把请求委托给 FSM 状态机
    }
  };

  var light=new Light();
  light.init();


var fsm = StateMachine.create({
  initial: 'off',
  events: [
    { name: 'buttonWasPressed', from: 'off', to: 'on' },
    { name: 'buttonWasPressed', from: 'on', to: 'off' }
  ],
  callbacks: {
    onbuttonWasPressed: function( event, from, to ){
      console.log( arguments );
    }
  },
  error: function( eventName, from, to, args, errorCode, errorMessage ) {
      console.log( arguments ); // 从一种状态试图切换到一种不可能到达的状态的时候
    }
});

button.onclick = function(){
  fsm.buttonWasPressed();
}
</script>

    </body>
</html>